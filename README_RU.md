# Telegram-Mail-Bot

Telegram-бот для пересылки сообщений с электронной почты (через IMAP) в указанный Telegram-канал или группу.

## Языки

* [English](README.md)
* [Русский](README_RU.md)

## Описание

Этот бот мониторит указанный почтовый ящик через протокол IMAP и автоматически пересылает новые сообщения в заданный Telegram-канал или группу. Он построен на базе библиотеки aiogram для взаимодействия с Telegram API и поддерживает модульную структуру с использованием "cogs" для расширяемости. Дополнительно, бот запускает HTTP-сервер на порту 4022 для мониторинга или других нужд.

Ключевые особенности:

* Автоматическая пересылка непрочитанных email в Telegram.
* Поддержка режимов разработки (development) и продакшена (production).
* Логирование событий через аудит-систему.
* Интеграция с Docker для легкого развертывания.
* Опциональная интеграция с GitHub. Реализована функция получения временной метки последнего коммита в utils/other.py. Может быть использована в каком-либо модуле при необходимости.

Бот разработан на Python и лицензирован под AGPL-3.0-only.

## Требования

* Python 3.10+ (рекомендуется 3.13.3).
* Библиотеки: указаны в requirements.txt.
* Доступ к IMAP-серверу (например, Gmail, Yandex.Mail).
* Telegram Bot Token (получите у @BotFather).
* Docker и Docker Compose для контейнеризации (опционально).

## Установка

### Через Docker (рекомендуется)

1. Клонируйте репозиторий:

   ```
   git clone https://github.com/Stormy-RPG/Telegram-Mail-Bot.git
   cd Telegram-Mail-Bot
   ```
2. Скопируйте пример конфигурации:

   ```
   cp .env.example .env
   ```

   Заполните .env необходимыми значениями (см. раздел "Конфигурация").
3. Соберите и запустите контейнер:

   ```
   make up
   ```

   Или вручную:

   ```
   docker compose up -d
   ```
4. Для просмотра логов:

   ```
   make logs -B
   ```

### Ручная установка

1. Клонируйте репозиторий (как выше).
2. Установите зависимости (рекомендуется использовать venv):

   ```
   pip install -r requirements.txt
   ```
3. Скопируйте и заполните .env (как выше).
4. Запустите бота:

   ```
   python main.py -mode production
   ```

   (Или -mode development для разработки).

## Конфигурация

Конфигурация осуществляется через файл .env. Пример:

```
# ----- GENERAL SETTINGS -----
PRODUCTION_TELEGRAM_API_TOKEN=ваш_токен_для_продакшена
DEVELOPMENT_TELEGRAM_API_TOKEN=ваш_токен_для_разработки
# Optional - leave empty if not used
GITHUB_TOKEN=токен_гитхаб

# ----- Email-to-Telegram forwarder -----
MODULE_TEXT=public/mail_forwarder.json  # Относительный путь к .json файлу, содержащему локализацию сообщений
IMAP_HOST=imap.example.com  # Например, imap.gmail.com
IMAP_PORT=993  # Стандартный порт для IMAP через SSL
MAIL_LOGIN=your@email.com
MAIL_PASSWORD=your_password
GROUP_ID=-100xxxxxxxxxx  # ID Telegram-канала или группы (используйте отрицательное значение для супергрупп/каналов)
# Optional - leave empty if not used
THREAD_ID=id_темы_в_группе
```

* **TELEGRAM_API_TOKEN** : Обязательно укажите хотя бы один (в зависимости от режима).
* **IMAP_** *: Данные для подключения к почте.
* **GROUP_ID** : ID целевого канала/группы (бот должен быть администратором).
* **THREAD_ID** : Опционально, для пересылки в конкретную тему в группе.

## Использование

После запуска бот будет автоматически проверять почту и пересылать новые сообщения в указанный канал.

* Для остановки: make down (Docker) или Ctrl+C (ручной запуск).
* Обновление: make update (pull из Git и перезапуск).
* Логи хранятся в ./logs (в Docker) или по пути, указанному в коде.

Если возникают ошибки, проверьте логи и убедитесь, что IMAP-доступ разрешен (для Gmail включите "Less secure app access" или используйте app password).

## Разработка

* Структура:
  * main.py: Точка входа, инициализация бота и HTTP-сервера.
  * cogs/: Модули расширения (например, для обработки email).
  * utils/: Утилиты (аудит, middleware).
  * public/: Публичные файлы, такие как mail_forwarder.json (конфигурация сообщений от бота).

Для добавления новых функций создайте новые модули в папке "cogs".

## Лицензия

Copyright (C) 2026 Stormy-RPG.
Лицензия: AGPL-3.0-only.
См. файл LICENSE для деталей.

## Контакты

Разработчик: Stormy-RPG
GitHub: [https://github.com/Stormy-RPG/Telegram-Mail-Bot](https://github.com/Stormy-RPG/Telegram-Mail-Bot)
Если нужны улучшения или есть вопросы, создайте issue или pull request
